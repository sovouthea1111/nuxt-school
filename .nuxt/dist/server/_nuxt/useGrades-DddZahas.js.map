{"version":3,"file":"useGrades-DddZahas.js","sources":["../../../../composables/useGrades.ts"],"sourcesContent":["import { ref } from 'vue'\nimport { useState } from 'nuxt/app'\nimport { useStudents } from '~/composables/useStudents'\n\ntype GradeEntry = {\n  id: string\n  studentId: string\n  subject: string\n  exam: string\n  score: number\n  date: string\n}\n\nfunction genId() {\n  return Math.random().toString(36).slice(2) + Date.now().toString(36)\n}\n\nexport function useGrades() {\n  const grades = useState<GradeEntry[]>('grades', () => [])\n  const initialized = ref(false)\n  if (process.client && !initialized.value) {\n    const raw = localStorage.getItem('grades')\n    if (raw) {\n      grades.value = JSON.parse(raw) as GradeEntry[]\n    } else {\n      const { students } = useStudents()\n      const subjects = ['Mathematics', 'Khmer', 'Science']\n      const exams = ['Midterm', 'Final']\n      const today = new Date()\n      const sample: GradeEntry[] = []\n      students.value.slice(0, 5).forEach((s, i) => {\n        subjects.forEach((subj, si) => {\n          exams.forEach((ex, ei) => {\n            const date = new Date(today)\n            date.setDate(today.getDate() - (si + ei + i))\n            const base = 60 + ((i * 7 + si * 9 + ei * 11) % 40)\n            const score = Math.min(100, Math.max(0, base))\n            sample.push({ id: genId(), studentId: s.id, subject: subj, exam: ex, score, date: date.toISOString() })\n          })\n        })\n      })\n      grades.value = sample\n      localStorage.setItem('grades', JSON.stringify(grades.value))\n    }\n    initialized.value = true\n  }\n  function persist() {\n    if (process.client) localStorage.setItem('grades', JSON.stringify(grades.value))\n  }\n  function list() {\n    return grades.value\n  }\n  function getById(id: string) {\n    return grades.value.find(g => g.id === id)\n  }\n  function create(payload: Omit<GradeEntry, 'id'>) {\n    grades.value.push({ id: genId(), ...payload, date: new Date(payload.date).toISOString() })\n    persist()\n  }\n  function update(id: string, payload: Omit<GradeEntry, 'id'>) {\n    const idx = grades.value.findIndex(g => g.id === id)\n    if (idx !== -1) {\n      grades.value[idx] = { id, ...payload, date: new Date(payload.date).toISOString() }\n      persist()\n    }\n  }\n  function remove(id: string) {\n    const idx = grades.value.findIndex(g => g.id === id)\n    if (idx !== -1) {\n      grades.value.splice(idx, 1)\n      persist()\n    }\n  }\n  return { grades, list, getById, create, update, remove }\n}\n"],"names":[],"mappings":";;;;;;;AAaA,SAAS,QAAQ;AACf,SAAO,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,CAAC,IAAI,KAAK,MAAM,SAAS,EAAE;AACrE;AAEO,SAAS,YAAY;AAC1B,QAAM,SAAS,SAAuB,UAAU,MAAM,CAAA,CAAE;AACpC,MAAI,KAAK;AA8B7B,WAAS,OAAO;AACd,WAAO,OAAO;AAAA,EAChB;AACA,WAAS,QAAQ,IAAY;AAC3B,WAAO,OAAO,MAAM,KAAK,CAAA,MAAK,EAAE,OAAO,EAAE;AAAA,EAC3C;AACA,WAAS,OAAO,SAAiC;AAC/C,WAAO,MAAM,KAAK,EAAE,IAAI,MAAA,GAAS,GAAG,SAAS,MAAM,IAAI,KAAK,QAAQ,IAAI,EAAE,YAAA,GAAe;AAAA,EAE3F;AACA,WAAS,OAAO,IAAY,SAAiC;AAC3D,UAAM,MAAM,OAAO,MAAM,UAAU,CAAA,MAAK,EAAE,OAAO,EAAE;AACnD,QAAI,QAAQ,IAAI;AACd,aAAO,MAAM,GAAG,IAAI,EAAE,IAAI,GAAG,SAAS,MAAM,IAAI,KAAK,QAAQ,IAAI,EAAE,cAAY;AAAA,IAEjF;AAAA,EACF;AACA,WAAS,OAAO,IAAY;AAC1B,UAAM,MAAM,OAAO,MAAM,UAAU,CAAA,MAAK,EAAE,OAAO,EAAE;AACnD,QAAI,QAAQ,IAAI;AACd,aAAO,MAAM,OAAO,KAAK,CAAC;AAAA,IAE5B;AAAA,EACF;AACA,SAAO,EAAE,QAAQ,MAAM,SAAS,QAAQ,QAAQ,OAAA;AAClD;"}