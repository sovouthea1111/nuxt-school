{"version":3,"file":"reports-BliJ11EQ.js","sources":["../../../../pages/grades/reports.vue"],"sourcesContent":["<template>\n  <section class=\"card\">\n    <div class=\"toolbar\">\n      <input class=\"input\" v-model=\"q\" placeholder=\"Filter by student or subject\" />\n      <div class=\"spacer\"></div>\n      <select class=\"select\" v-model=\"exam\">\n        <option value=\"\">All Exams</option>\n        <option v-for=\"e in exams\" :key=\"e\">{{ e }}</option>\n      </select>\n    </div>\n    <table class=\"table\">\n      <thead>\n        <tr>\n          <th>Student</th>\n          <th>Subject</th>\n          <th>Avg</th>\n          <th>Best</th>\n          <th>Latest Exam</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"row in summary\" :key=\"row.key\">\n          <td>{{ row.student }}</td>\n          <td>{{ row.subject }}</td>\n          <td><span class=\"badge\">{{ row.avg }}</span></td>\n          <td>{{ row.max }}</td>\n          <td>{{ row.latestExam }}</td>\n        </tr>\n        <tr v-if=\"summary.length === 0\">\n          <td colspan=\"5\" class=\"muted\">No grades</td>\n        </tr>\n      </tbody>\n    </table>\n  </section>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue'\nimport { useGrades } from '~/composables/useGrades'\nimport { useStudents } from '~/composables/useStudents'\nconst { grades } = useGrades()\nconst { students } = useStudents()\nfunction studentName(id: string) { return students.value.find(s => s.id === id)?.name || 'Unknown' }\nconst q = ref('')\nconst exam = ref('')\nconst exams = computed(() => Array.from(new Set(grades.value.map(g => g.exam))).sort())\nconst filtered = computed(() => {\n  const v = q.value.trim().toLowerCase()\n  return grades.value.filter(g => {\n    const text = `${studentName(g.studentId)} ${g.subject}`.toLowerCase()\n    const matchesExam = !exam.value || g.exam === exam.value\n    return (!v || text.includes(v)) && matchesExam\n  })\n})\nconst summary = computed(() => {\n  const map = new Map<string, { scores: number[]; latestExam: string }>()\n  filtered.value.forEach(g => {\n    const key = `${g.studentId}::${g.subject}`\n    const cur = map.get(key) || { scores: [], latestExam: '' }\n    cur.scores.push(g.score)\n    cur.latestExam = g.exam\n    map.set(key, cur)\n  })\n  return Array.from(map.entries()).map(([key, v]) => {\n    const [studentId, subject] = key.split('::')\n    const avg = v.scores.length ? Math.round(v.scores.reduce((a,b) => a+b, 0) / v.scores.length) : 0\n    const max = v.scores.length ? Math.max(...v.scores) : 0\n    return { key, student: studentName(studentId), subject, avg, max, latestExam: v.latestExam }\n  }).sort((a,b) => b.avg - a.avg)\n})\n</script>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderList","_ssrInterpolate"],"mappings":";;;;;;;;;;;;;;;;;;;;AAwCA,UAAM,EAAE,OAAA,IAAW,UAAA;AACnB,UAAM,EAAE,SAAA,IAAa,YAAA;AACrB,aAAS,YAAY,IAAY;AAAE,aAAO,SAAS,MAAM,KAAK,CAAA,MAAK,EAAE,OAAO,EAAE,GAAG,QAAQ;AAAA,IAAU;AACnG,UAAM,IAAI,IAAI,EAAE;AAChB,UAAM,OAAO,IAAI,EAAE;AACnB,UAAM,QAAQ,SAAS,MAAM,MAAM,KAAK,IAAI,IAAI,OAAO,MAAM,IAAI,OAAK,EAAE,IAAI,CAAC,CAAC,EAAE,MAAM;AACtF,UAAM,WAAW,SAAS,MAAM;AAC9B,YAAM,IAAI,EAAE,MAAM,KAAA,EAAO,YAAA;AACzB,aAAO,OAAO,MAAM,OAAO,CAAA,MAAK;AAC9B,cAAM,OAAO,GAAG,YAAY,EAAE,SAAS,CAAC,IAAI,EAAE,OAAO,GAAG,YAAA;AACxD,cAAM,cAAc,CAAC,KAAK,SAAS,EAAE,SAAS,KAAK;AACnD,gBAAQ,CAAC,KAAK,KAAK,SAAS,CAAC,MAAM;AAAA,MACrC,CAAC;AAAA,IACH,CAAC;AACD,UAAM,UAAU,SAAS,MAAM;AAC7B,YAAM,0BAAU,IAAA;AAChB,eAAS,MAAM,QAAQ,CAAA,MAAK;AAC1B,cAAM,MAAM,GAAG,EAAE,SAAS,KAAK,EAAE,OAAO;AACxC,cAAM,MAAM,IAAI,IAAI,GAAG,KAAK,EAAE,QAAQ,CAAA,GAAI,YAAY,GAAA;AACtD,YAAI,OAAO,KAAK,EAAE,KAAK;AACvB,YAAI,aAAa,EAAE;AACnB,YAAI,IAAI,KAAK,GAAG;AAAA,MAClB,CAAC;AACD,aAAO,MAAM,KAAK,IAAI,QAAA,CAAS,EAAE,IAAI,CAAC,CAAC,KAAK,CAAC,MAAM;AACjD,cAAM,CAAC,WAAW,OAAO,IAAI,IAAI,MAAM,IAAI;AAC3C,cAAM,MAAM,EAAE,OAAO,SAAS,KAAK,MAAM,EAAE,OAAO,OAAO,CAAC,GAAE,MAAM,IAAE,GAAG,CAAC,IAAI,EAAE,OAAO,MAAM,IAAI;AAC/F,cAAM,MAAM,EAAE,OAAO,SAAS,KAAK,IAAI,GAAG,EAAE,MAAM,IAAI;AACtD,eAAO,EAAE,KAAK,SAAS,YAAY,SAAS,GAAG,SAAS,KAAK,KAAK,YAAY,EAAE,WAAA;AAAA,MAClF,CAAC,EAAE,KAAK,CAAC,GAAE,MAAM,EAAE,MAAM,EAAE,GAAG;AAAA,IAChC,CAAC;;uBApEUA,eAAAC,WAAA,EAAA,OAAM,UAAM,MAAA,CAAA,qEAEa,EAAA,KAAC,qJAEC,KAAA,KAAI,oBAAJ,KAAA,OAAI,EAAA,kBAAJ,KAAA,OAAI,EAAA,CAAA,IAAA,cAAA;AAEdC,oBAAA,MAAA,QAAL,MAAC;4DAFc,KAAA,KAAI,oBAAJ,KAAA,OAAI,IAAA,kBAAJ,KAAA,OAAI,IAAA,CAAA,IAAA,cAAA,qBAEK,CAAC;;;AActBA,oBAAA,QAAA,QAAP,QAAG;yBACLC,eAAA,IAAI,OAAO,aACXA,eAAA,IAAI,OAAO,iCACSA,eAAA,IAAI,GAAG,oBAC3BA,eAAA,IAAI,GAAG,aACPA,eAAA,IAAI,UAAU;;;AAEb,UAAA,QAAA,MAAQ,WAAM,GAAA;;;;;;;;;;;;;;;"}