{"version":3,"file":"useAttendance-Dyr7yiAa.js","sources":["../../../../composables/useAttendance.ts"],"sourcesContent":["import { ref } from 'vue'\r\nimport { useState } from 'nuxt/app'\r\nimport { useStudents } from '~/composables/useStudents'\r\n\r\ntype AttendanceStatus = 'Present' | 'Absent' | 'Late'\r\ntype Attendance = {\r\n  id: string\r\n  studentId: string\r\n  date: string\r\n  status: AttendanceStatus\r\n}\r\n\r\nfunction genId() {\r\n  return Math.random().toString(36).slice(2) + Date.now().toString(36)\r\n}\r\n\r\nexport function useAttendance() {\r\n  const records = useState<Attendance[]>('attendance', () => [])\r\n  const initialized = ref(false)\r\n  if (process.client && !initialized.value) {\r\n    const raw = localStorage.getItem('attendance')\r\n    if (raw) {\r\n      records.value = JSON.parse(raw) as Attendance[]\r\n    } else {\r\n      const { students } = useStudents()\r\n      const today = new Date()\r\n      const sample: Attendance[] = []\r\n      for (let d = 0; d < 5; d++) {\r\n        const date = new Date(today)\r\n        date.setDate(today.getDate() - d)\r\n        const iso = date.toISOString()\r\n        students.value.forEach((s, i) => {\r\n          const roll = (i + d) % 10\r\n          const status: AttendanceStatus = roll < 7 ? 'Present' : roll < 9 ? 'Late' : 'Absent'\r\n          sample.push({ id: genId(), studentId: s.id, date: iso, status })\r\n        })\r\n      }\r\n      records.value = sample\r\n      localStorage.setItem('attendance', JSON.stringify(records.value))\r\n    }\r\n    initialized.value = true\r\n  }\r\n  function persist() {\r\n    if (process.client) localStorage.setItem('attendance', JSON.stringify(records.value))\r\n  }\r\n  function list() {\r\n    return records.value\r\n  }\r\n  function upsert(record: Omit<Attendance, 'id'>) {\r\n    const idx = records.value.findIndex(r => r.studentId === record.studentId && r.date.slice(0,10) === record.date.slice(0,10))\r\n    if (idx !== -1) {\r\n      records.value[idx] = { ...records.value[idx], ...record }\r\n    } else {\r\n      records.value.push({ id: genId(), ...record })\r\n    }\r\n    persist()\r\n  }\r\n  function bulkMark(date: string, entries: { studentId: string; status: AttendanceStatus }[]) {\r\n    entries.forEach(e => upsert({ studentId: e.studentId, date: new Date(date).toISOString(), status: e.status }))\r\n  }\r\n  function remove(id: string) {\r\n    const idx = records.value.findIndex(r => r.id === id)\r\n    if (idx !== -1) {\r\n      records.value.splice(idx, 1)\r\n      persist()\r\n    }\r\n  }\r\n  return { records, list, upsert, bulkMark, remove }\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAYA,SAAS,QAAQ;AACf,SAAO,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,CAAC,IAAI,KAAK,MAAM,SAAS,EAAE;AACrE;AAEO,SAAS,gBAAgB;AAC9B,QAAM,UAAU,SAAuB,cAAc,MAAM,CAAA,CAAE;AACzC,MAAI,KAAK;AA2B7B,WAAS,OAAO;AACd,WAAO,QAAQ;AAAA,EACjB;AACA,WAAS,OAAO,QAAgC;AAC9C,UAAM,MAAM,QAAQ,MAAM,UAAU,OAAK,EAAE,cAAc,OAAO,aAAa,EAAE,KAAK,MAAM,GAAE,EAAE,MAAM,OAAO,KAAK,MAAM,GAAE,EAAE,CAAC;AAC3H,QAAI,QAAQ,IAAI;AACd,cAAQ,MAAM,GAAG,IAAI,EAAE,GAAG,QAAQ,MAAM,GAAG,GAAG,GAAG,OAAA;AAAA,IACnD,OAAO;AACL,cAAQ,MAAM,KAAK,EAAE,IAAI,SAAS,GAAG,QAAQ;AAAA,IAC/C;AAAA,EAEF;AACA,WAAS,SAAS,MAAc,SAA4D;AAC1F,YAAQ,QAAQ,CAAA,MAAK,OAAO,EAAE,WAAW,EAAE,WAAW,MAAM,IAAI,KAAK,IAAI,EAAE,YAAA,GAAe,QAAQ,EAAE,OAAA,CAAQ,CAAC;AAAA,EAC/G;AACA,WAAS,OAAO,IAAY;AAC1B,UAAM,MAAM,QAAQ,MAAM,UAAU,CAAA,MAAK,EAAE,OAAO,EAAE;AACpD,QAAI,QAAQ,IAAI;AACd,cAAQ,MAAM,OAAO,KAAK,CAAC;AAAA,IAE7B;AAAA,EACF;AACA,SAAO,EAAE,SAAS,MAAM,QAAQ,UAAU,OAAA;AAC5C;"}